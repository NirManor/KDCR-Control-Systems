function q=inverse_kin(X,elbow)
% This function calculates the inverse kinematics
% X is a vector with the followibg format: [x, y, phi] of the tool
% The function returns the actuators position with the format: [teta1,
% teta2, teta3].
% Those vectors are calculated according elbow vector configuration.
% The vector elbow is 1X3 which each element is 1 or -1.

global R L r

% The tool position and orientation:
x=X(1);
y=X(2);
phi=X(3);

% The plate's edges
x_a3=x+r*cos(phi);
y_a3=y+r*sin(phi);
x_a1=x+r*cos(phi+pi/3);
y_a1=y+r*sin(phi+pi/3);

% Solution
y_b2=[(R^2*y - L^2*y + x^2*y + y^3 + x*((- L^2 + 2*L*R - R^2 + x^2 + y^2)*(L^2 + 2*L*R + R^2 - x^2 - y^2))^(1/2))/(2*(x^2 + y^2));
    (R^2*y - L^2*y + x^2*y + y^3 - x*((- L^2 + 2*L*R - R^2 + x^2 + y^2)*(L^2 + 2*L*R + R^2 - x^2 - y^2))^(1/2))/(2*(x^2 + y^2))];
if x == 0
    x_b2(1)=sqrt(R^2-y_b2(1)^2);
    x_b2(2)=sqrt(R^2-y_b2(2)^2);
else
    x_b2=(x^2+y^2-2*y*y_b2+R^2-L^2)/(2*x);
end

teta2=atan2(y_b2,x_b2);

d3=[(R^2 + 2*sin(phi)*R*r + 2*R*y + r^2 + 2*cos(phi)*r*x + 2*sin(phi)*r*y + x^2 + y^2)^(1/2);-(R^2 + 2*sin(phi)*R*r + 2*R*y + r^2 + 2*cos(phi)*r*x + 2*sin(phi)*r*y + x^2 + y^2)^(1/2)];


y_b1 =[(- 2*x^2*(-(L^4*r^2*cos(phi)^2 - 2*3^(1/2)*L^4*r^2*cos(phi)*sin(phi) + 3*L^4*r^2*sin(phi)^2 + 4*L^4*r*x*cos(phi) - 4*3^(1/2)*L^4*r*x*sin(phi) + 4*L^4*x^2 - 2*L^2*R^2*r^2*cos(phi)^2 + 4*3^(1/2)*L^2*R^2*r^2*cos(phi)*sin(phi) - 6*L^2*R^2*r^2*sin(phi)^2 - 8*L^2*R^2*r*x*cos(phi) + 8*3^(1/2)*L^2*R^2*r*x*sin(phi) - 8*L^2*R^2*x^2 - 2*L^2*r^4*cos(phi)^4 + 4*3^(1/2)*L^2*r^4*cos(phi)^3*sin(phi) - 8*L^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*L^2*r^4*cos(phi)*sin(phi)^3 - 6*L^2*r^4*sin(phi)^4 - 10*L^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*L^2*r^3*x*cos(phi)^2*sin(phi) - 26*L^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*L^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*L^2*r^3*y*cos(phi)^3 + 10*L^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*L^2*r^3*y*cos(phi)*sin(phi)^2 - 6*L^2*r^3*y*sin(phi)^3 - 18*L^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*L^2*r^2*x^2*cos(phi)*sin(phi) - 38*L^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*L^2*r^2*x*y*cos(phi)^2 + 16*L^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*L^2*r^2*x*y*sin(phi)^2 - 2*L^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*L^2*r^2*y^2*cos(phi)*sin(phi) - 6*L^2*r^2*y^2*sin(phi)^2 - 16*L^2*r*x^3*cos(phi) + 16*3^(1/2)*L^2*r*x^3*sin(phi) - 8*3^(1/2)*L^2*r*x^2*y*cos(phi) - 8*L^2*r*x^2*y*sin(phi) - 8*L^2*r*x*y^2*cos(phi) + 8*3^(1/2)*L^2*r*x*y^2*sin(phi) - 8*L^2*x^4 - 8*L^2*x^2*y^2 + R^4*r^2*cos(phi)^2 - 2*3^(1/2)*R^4*r^2*cos(phi)*sin(phi) + 3*R^4*r^2*sin(phi)^2 + 4*R^4*r*x*cos(phi) - 4*3^(1/2)*R^4*r*x*sin(phi) + 4*R^4*x^2 - 2*R^2*r^4*cos(phi)^4 + 4*3^(1/2)*R^2*r^4*cos(phi)^3*sin(phi) - 8*R^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*R^2*r^4*cos(phi)*sin(phi)^3 - 6*R^2*r^4*sin(phi)^4 - 10*R^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*R^2*r^3*x*cos(phi)^2*sin(phi) - 26*R^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*R^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*R^2*r^3*y*cos(phi)^3 + 10*R^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*R^2*r^3*y*cos(phi)*sin(phi)^2 - 6*R^2*r^3*y*sin(phi)^3 - 18*R^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*R^2*r^2*x^2*cos(phi)*sin(phi) - 38*R^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*R^2*r^2*x*y*cos(phi)^2 + 16*R^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*R^2*r^2*x*y*sin(phi)^2 - 2*R^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*R^2*r^2*y^2*cos(phi)*sin(phi) - 6*R^2*r^2*y^2*sin(phi)^2 - 16*R^2*r*x^3*cos(phi) + 16*3^(1/2)*R^2*r*x^3*sin(phi) - 8*3^(1/2)*R^2*r*x^2*y*cos(phi) - 8*R^2*r*x^2*y*sin(phi) - 8*R^2*r*x*y^2*cos(phi) + 8*3^(1/2)*R^2*r*x*y^2*sin(phi) - 8*R^2*x^4 - 8*R^2*x^2*y^2 + r^6*cos(phi)^6 - 2*3^(1/2)*r^6*cos(phi)^5*sin(phi) + 5*r^6*cos(phi)^4*sin(phi)^2 - 4*3^(1/2)*r^6*cos(phi)^3*sin(phi)^3 + 7*r^6*cos(phi)^2*sin(phi)^4 - 2*3^(1/2)*r^6*cos(phi)*sin(phi)^5 + 3*r^6*sin(phi)^6 + 6*r^5*x*cos(phi)^5 - 10*3^(1/2)*r^5*x*cos(phi)^4*sin(phi) + 28*r^5*x*cos(phi)^3*sin(phi)^2 - 20*3^(1/2)*r^5*x*cos(phi)^2*sin(phi)^3 + 22*r^5*x*cos(phi)*sin(phi)^4 - 10*3^(1/2)*r^5*x*sin(phi)^5 + 2*3^(1/2)*r^5*y*cos(phi)^5 - 10*r^5*y*cos(phi)^4*sin(phi) + 4*3^(1/2)*r^5*y*cos(phi)^3*sin(phi)^2 - 4*r^5*y*cos(phi)^2*sin(phi)^3 + 2*3^(1/2)*r^5*y*cos(phi)*sin(phi)^4 + 6*r^5*y*sin(phi)^5 + 15*r^4*x^2*cos(phi)^4 - 24*3^(1/2)*r^4*x^2*cos(phi)^3*sin(phi) + 66*r^4*x^2*cos(phi)^2*sin(phi)^2 - 32*3^(1/2)*r^4*x^2*cos(phi)*sin(phi)^3 + 43*r^4*x^2*sin(phi)^4 + 10*3^(1/2)*r^4*x*y*cos(phi)^4 - 32*r^4*x*y*cos(phi)^3*sin(phi) + 12*3^(1/2)*r^4*x*y*cos(phi)^2*sin(phi)^2 - 16*r^4*x*y*cos(phi)*sin(phi)^3 - 14*3^(1/2)*r^4*x*y*sin(phi)^4 + 5*r^4*y^2*cos(phi)^4 - 8*3^(1/2)*r^4*y^2*cos(phi)^3*sin(phi) + 6*r^4*y^2*cos(phi)^2*sin(phi)^2 + 9*r^4*y^2*sin(phi)^4 + 22*r^3*x^3*cos(phi)^3 - 34*3^(1/2)*r^3*x^3*cos(phi)^2*sin(phi) + 70*r^3*x^3*cos(phi)*sin(phi)^2 - 34*3^(1/2)*r^3*x^3*sin(phi)^3 + 18*3^(1/2)*r^3*x^2*y*cos(phi)^3 - 42*r^3*x^2*y*cos(phi)^2*sin(phi) + 18*3^(1/2)*r^3*x^2*y*cos(phi)*sin(phi)^2 + 38*r^3*x^2*y*sin(phi)^3 + 22*r^3*x*y^2*cos(phi)^3 - 18*3^(1/2)*r^3*x*y^2*cos(phi)^2*sin(phi) + 6*r^3*x*y^2*cos(phi)*sin(phi)^2 - 18*3^(1/2)*r^3*x*y^2*sin(phi)^3 + 2*3^(1/2)*r^3*y^3*cos(phi)^3 - 10*r^3*y^3*cos(phi)^2*sin(phi) + 2*3^(1/2)*r^3*y^3*cos(phi)*sin(phi)^2 + 6*r^3*y^3*sin(phi)^3 + 21*r^2*x^4*cos(phi)^2 - 26*3^(1/2)*r^2*x^4*cos(phi)*sin(phi) + 47*r^2*x^4*sin(phi)^2 + 16*3^(1/2)*r^2*x^3*y*cos(phi)^2 - 32*r^2*x^3*y*cos(phi)*sin(phi) - 16*3^(1/2)*r^2*x^3*y*sin(phi)^2 + 30*r^2*x^2*y^2*cos(phi)^2 - 12*3^(1/2)*r^2*x^2*y^2*cos(phi)*sin(phi) + 42*r^2*x^2*y^2*sin(phi)^2 + 8*3^(1/2)*r^2*x*y^3*cos(phi)^2 - 16*r^2*x*y^3*cos(phi)*sin(phi) - 8*3^(1/2)*r^2*x*y^3*sin(phi)^2 + r^2*y^4*cos(phi)^2 - 2*3^(1/2)*r^2*y^4*cos(phi)*sin(phi) + 3*r^2*y^4*sin(phi)^2 + 12*r*x^5*cos(phi) - 12*3^(1/2)*r*x^5*sin(phi) + 8*3^(1/2)*r*x^4*y*cos(phi) + 8*r*x^4*y*sin(phi) + 16*r*x^3*y^2*cos(phi) - 16*3^(1/2)*r*x^3*y^2*sin(phi) + 8*3^(1/2)*r*x^2*y^3*cos(phi) + 8*r*x^2*y^3*sin(phi) + 4*r*x*y^4*cos(phi) - 4*3^(1/2)*r*x*y^4*sin(phi) + 4*x^6 + 8*x^4*y^2 + 4*x^2*y^4)/(r^4*cos(phi)^4 - 4*3^(1/2)*r^4*cos(phi)^3*sin(phi) + 18*r^4*cos(phi)^2*sin(phi)^2 - 12*3^(1/2)*r^4*cos(phi)*sin(phi)^3 + 9*r^4*sin(phi)^4 + 8*r^3*x*cos(phi)^3 - 24*3^(1/2)*r^3*x*cos(phi)^2*sin(phi) + 72*r^3*x*cos(phi)*sin(phi)^2 - 24*3^(1/2)*r^3*x*sin(phi)^3 + 24*r^2*x^2*cos(phi)^2 - 48*3^(1/2)*r^2*x^2*cos(phi)*sin(phi) + 72*r^2*x^2*sin(phi)^2 + 32*r*x^3*cos(phi) - 32*3^(1/2)*r*x^3*sin(phi) + 16*x^4))^(1/2) + r^3*sin(phi + pi/3)^3 - L^2*y + R^2*y + x^2*y + y^3 + r^3*cos(phi + pi/3)^2*sin(phi + pi/3) - L^2*r*sin(phi + pi/3) + R^2*r*sin(phi + pi/3) + r*x^2*sin(phi + pi/3) + 3*r*y^2*sin(phi + pi/3) - 2*r^2*cos(phi + pi/3)^2*(-(L^4*r^2*cos(phi)^2 - 2*3^(1/2)*L^4*r^2*cos(phi)*sin(phi) + 3*L^4*r^2*sin(phi)^2 + 4*L^4*r*x*cos(phi) - 4*3^(1/2)*L^4*r*x*sin(phi) + 4*L^4*x^2 - 2*L^2*R^2*r^2*cos(phi)^2 + 4*3^(1/2)*L^2*R^2*r^2*cos(phi)*sin(phi) - 6*L^2*R^2*r^2*sin(phi)^2 - 8*L^2*R^2*r*x*cos(phi) + 8*3^(1/2)*L^2*R^2*r*x*sin(phi) - 8*L^2*R^2*x^2 - 2*L^2*r^4*cos(phi)^4 + 4*3^(1/2)*L^2*r^4*cos(phi)^3*sin(phi) - 8*L^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*L^2*r^4*cos(phi)*sin(phi)^3 - 6*L^2*r^4*sin(phi)^4 - 10*L^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*L^2*r^3*x*cos(phi)^2*sin(phi) - 26*L^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*L^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*L^2*r^3*y*cos(phi)^3 + 10*L^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*L^2*r^3*y*cos(phi)*sin(phi)^2 - 6*L^2*r^3*y*sin(phi)^3 - 18*L^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*L^2*r^2*x^2*cos(phi)*sin(phi) - 38*L^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*L^2*r^2*x*y*cos(phi)^2 + 16*L^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*L^2*r^2*x*y*sin(phi)^2 - 2*L^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*L^2*r^2*y^2*cos(phi)*sin(phi) - 6*L^2*r^2*y^2*sin(phi)^2 - 16*L^2*r*x^3*cos(phi) + 16*3^(1/2)*L^2*r*x^3*sin(phi) - 8*3^(1/2)*L^2*r*x^2*y*cos(phi) - 8*L^2*r*x^2*y*sin(phi) - 8*L^2*r*x*y^2*cos(phi) + 8*3^(1/2)*L^2*r*x*y^2*sin(phi) - 8*L^2*x^4 - 8*L^2*x^2*y^2 + R^4*r^2*cos(phi)^2 - 2*3^(1/2)*R^4*r^2*cos(phi)*sin(phi) + 3*R^4*r^2*sin(phi)^2 + 4*R^4*r*x*cos(phi) - 4*3^(1/2)*R^4*r*x*sin(phi) + 4*R^4*x^2 - 2*R^2*r^4*cos(phi)^4 + 4*3^(1/2)*R^2*r^4*cos(phi)^3*sin(phi) - 8*R^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*R^2*r^4*cos(phi)*sin(phi)^3 - 6*R^2*r^4*sin(phi)^4 - 10*R^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*R^2*r^3*x*cos(phi)^2*sin(phi) - 26*R^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*R^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*R^2*r^3*y*cos(phi)^3 + 10*R^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*R^2*r^3*y*cos(phi)*sin(phi)^2 - 6*R^2*r^3*y*sin(phi)^3 - 18*R^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*R^2*r^2*x^2*cos(phi)*sin(phi) - 38*R^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*R^2*r^2*x*y*cos(phi)^2 + 16*R^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*R^2*r^2*x*y*sin(phi)^2 - 2*R^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*R^2*r^2*y^2*cos(phi)*sin(phi) - 6*R^2*r^2*y^2*sin(phi)^2 - 16*R^2*r*x^3*cos(phi) + 16*3^(1/2)*R^2*r*x^3*sin(phi) - 8*3^(1/2)*R^2*r*x^2*y*cos(phi) - 8*R^2*r*x^2*y*sin(phi) - 8*R^2*r*x*y^2*cos(phi) + 8*3^(1/2)*R^2*r*x*y^2*sin(phi) - 8*R^2*x^4 - 8*R^2*x^2*y^2 + r^6*cos(phi)^6 - 2*3^(1/2)*r^6*cos(phi)^5*sin(phi) + 5*r^6*cos(phi)^4*sin(phi)^2 - 4*3^(1/2)*r^6*cos(phi)^3*sin(phi)^3 + 7*r^6*cos(phi)^2*sin(phi)^4 - 2*3^(1/2)*r^6*cos(phi)*sin(phi)^5 + 3*r^6*sin(phi)^6 + 6*r^5*x*cos(phi)^5 - 10*3^(1/2)*r^5*x*cos(phi)^4*sin(phi) + 28*r^5*x*cos(phi)^3*sin(phi)^2 - 20*3^(1/2)*r^5*x*cos(phi)^2*sin(phi)^3 + 22*r^5*x*cos(phi)*sin(phi)^4 - 10*3^(1/2)*r^5*x*sin(phi)^5 + 2*3^(1/2)*r^5*y*cos(phi)^5 - 10*r^5*y*cos(phi)^4*sin(phi) + 4*3^(1/2)*r^5*y*cos(phi)^3*sin(phi)^2 - 4*r^5*y*cos(phi)^2*sin(phi)^3 + 2*3^(1/2)*r^5*y*cos(phi)*sin(phi)^4 + 6*r^5*y*sin(phi)^5 + 15*r^4*x^2*cos(phi)^4 - 24*3^(1/2)*r^4*x^2*cos(phi)^3*sin(phi) + 66*r^4*x^2*cos(phi)^2*sin(phi)^2 - 32*3^(1/2)*r^4*x^2*cos(phi)*sin(phi)^3 + 43*r^4*x^2*sin(phi)^4 + 10*3^(1/2)*r^4*x*y*cos(phi)^4 - 32*r^4*x*y*cos(phi)^3*sin(phi) + 12*3^(1/2)*r^4*x*y*cos(phi)^2*sin(phi)^2 - 16*r^4*x*y*cos(phi)*sin(phi)^3 - 14*3^(1/2)*r^4*x*y*sin(phi)^4 + 5*r^4*y^2*cos(phi)^4 - 8*3^(1/2)*r^4*y^2*cos(phi)^3*sin(phi) + 6*r^4*y^2*cos(phi)^2*sin(phi)^2 + 9*r^4*y^2*sin(phi)^4 + 22*r^3*x^3*cos(phi)^3 - 34*3^(1/2)*r^3*x^3*cos(phi)^2*sin(phi) + 70*r^3*x^3*cos(phi)*sin(phi)^2 - 34*3^(1/2)*r^3*x^3*sin(phi)^3 + 18*3^(1/2)*r^3*x^2*y*cos(phi)^3 - 42*r^3*x^2*y*cos(phi)^2*sin(phi) + 18*3^(1/2)*r^3*x^2*y*cos(phi)*sin(phi)^2 + 38*r^3*x^2*y*sin(phi)^3 + 22*r^3*x*y^2*cos(phi)^3 - 18*3^(1/2)*r^3*x*y^2*cos(phi)^2*sin(phi) + 6*r^3*x*y^2*cos(phi)*sin(phi)^2 - 18*3^(1/2)*r^3*x*y^2*sin(phi)^3 + 2*3^(1/2)*r^3*y^3*cos(phi)^3 - 10*r^3*y^3*cos(phi)^2*sin(phi) + 2*3^(1/2)*r^3*y^3*cos(phi)*sin(phi)^2 + 6*r^3*y^3*sin(phi)^3 + 21*r^2*x^4*cos(phi)^2 - 26*3^(1/2)*r^2*x^4*cos(phi)*sin(phi) + 47*r^2*x^4*sin(phi)^2 + 16*3^(1/2)*r^2*x^3*y*cos(phi)^2 - 32*r^2*x^3*y*cos(phi)*sin(phi) - 16*3^(1/2)*r^2*x^3*y*sin(phi)^2 + 30*r^2*x^2*y^2*cos(phi)^2 - 12*3^(1/2)*r^2*x^2*y^2*cos(phi)*sin(phi) + 42*r^2*x^2*y^2*sin(phi)^2 + 8*3^(1/2)*r^2*x*y^3*cos(phi)^2 - 16*r^2*x*y^3*cos(phi)*sin(phi) - 8*3^(1/2)*r^2*x*y^3*sin(phi)^2 + r^2*y^4*cos(phi)^2 - 2*3^(1/2)*r^2*y^4*cos(phi)*sin(phi) + 3*r^2*y^4*sin(phi)^2 + 12*r*x^5*cos(phi) - 12*3^(1/2)*r*x^5*sin(phi) + 8*3^(1/2)*r*x^4*y*cos(phi) + 8*r*x^4*y*sin(phi) + 16*r*x^3*y^2*cos(phi) - 16*3^(1/2)*r*x^3*y^2*sin(phi) + 8*3^(1/2)*r*x^2*y^3*cos(phi) + 8*r*x^2*y^3*sin(phi) + 4*r*x*y^4*cos(phi) - 4*3^(1/2)*r*x*y^4*sin(phi) + 4*x^6 + 8*x^4*y^2 + 4*x^2*y^4)/(r^4*cos(phi)^4 - 4*3^(1/2)*r^4*cos(phi)^3*sin(phi) + 18*r^4*cos(phi)^2*sin(phi)^2 - 12*3^(1/2)*r^4*cos(phi)*sin(phi)^3 + 9*r^4*sin(phi)^4 + 8*r^3*x*cos(phi)^3 - 24*3^(1/2)*r^3*x*cos(phi)^2*sin(phi) + 72*r^3*x*cos(phi)*sin(phi)^2 - 24*3^(1/2)*r^3*x*sin(phi)^3 + 24*r^2*x^2*cos(phi)^2 - 48*3^(1/2)*r^2*x^2*cos(phi)*sin(phi) + 72*r^2*x^2*sin(phi)^2 + 32*r*x^3*cos(phi) - 32*3^(1/2)*r*x^3*sin(phi) + 16*x^4))^(1/2) + r^2*y*cos(phi + pi/3)^2 + 3*r^2*y*sin(phi + pi/3)^2 - 4*r*x*cos(phi + pi/3)*(-(L^4*r^2*cos(phi)^2 - 2*3^(1/2)*L^4*r^2*cos(phi)*sin(phi) + 3*L^4*r^2*sin(phi)^2 + 4*L^4*r*x*cos(phi) - 4*3^(1/2)*L^4*r*x*sin(phi) + 4*L^4*x^2 - 2*L^2*R^2*r^2*cos(phi)^2 + 4*3^(1/2)*L^2*R^2*r^2*cos(phi)*sin(phi) - 6*L^2*R^2*r^2*sin(phi)^2 - 8*L^2*R^2*r*x*cos(phi) + 8*3^(1/2)*L^2*R^2*r*x*sin(phi) - 8*L^2*R^2*x^2 - 2*L^2*r^4*cos(phi)^4 + 4*3^(1/2)*L^2*r^4*cos(phi)^3*sin(phi) - 8*L^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*L^2*r^4*cos(phi)*sin(phi)^3 - 6*L^2*r^4*sin(phi)^4 - 10*L^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*L^2*r^3*x*cos(phi)^2*sin(phi) - 26*L^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*L^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*L^2*r^3*y*cos(phi)^3 + 10*L^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*L^2*r^3*y*cos(phi)*sin(phi)^2 - 6*L^2*r^3*y*sin(phi)^3 - 18*L^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*L^2*r^2*x^2*cos(phi)*sin(phi) - 38*L^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*L^2*r^2*x*y*cos(phi)^2 + 16*L^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*L^2*r^2*x*y*sin(phi)^2 - 2*L^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*L^2*r^2*y^2*cos(phi)*sin(phi) - 6*L^2*r^2*y^2*sin(phi)^2 - 16*L^2*r*x^3*cos(phi) + 16*3^(1/2)*L^2*r*x^3*sin(phi) - 8*3^(1/2)*L^2*r*x^2*y*cos(phi) - 8*L^2*r*x^2*y*sin(phi) - 8*L^2*r*x*y^2*cos(phi) + 8*3^(1/2)*L^2*r*x*y^2*sin(phi) - 8*L^2*x^4 - 8*L^2*x^2*y^2 + R^4*r^2*cos(phi)^2 - 2*3^(1/2)*R^4*r^2*cos(phi)*sin(phi) + 3*R^4*r^2*sin(phi)^2 + 4*R^4*r*x*cos(phi) - 4*3^(1/2)*R^4*r*x*sin(phi) + 4*R^4*x^2 - 2*R^2*r^4*cos(phi)^4 + 4*3^(1/2)*R^2*r^4*cos(phi)^3*sin(phi) - 8*R^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*R^2*r^4*cos(phi)*sin(phi)^3 - 6*R^2*r^4*sin(phi)^4 - 10*R^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*R^2*r^3*x*cos(phi)^2*sin(phi) - 26*R^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*R^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*R^2*r^3*y*cos(phi)^3 + 10*R^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*R^2*r^3*y*cos(phi)*sin(phi)^2 - 6*R^2*r^3*y*sin(phi)^3 - 18*R^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*R^2*r^2*x^2*cos(phi)*sin(phi) - 38*R^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*R^2*r^2*x*y*cos(phi)^2 + 16*R^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*R^2*r^2*x*y*sin(phi)^2 - 2*R^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*R^2*r^2*y^2*cos(phi)*sin(phi) - 6*R^2*r^2*y^2*sin(phi)^2 - 16*R^2*r*x^3*cos(phi) + 16*3^(1/2)*R^2*r*x^3*sin(phi) - 8*3^(1/2)*R^2*r*x^2*y*cos(phi) - 8*R^2*r*x^2*y*sin(phi) - 8*R^2*r*x*y^2*cos(phi) + 8*3^(1/2)*R^2*r*x*y^2*sin(phi) - 8*R^2*x^4 - 8*R^2*x^2*y^2 + r^6*cos(phi)^6 - 2*3^(1/2)*r^6*cos(phi)^5*sin(phi) + 5*r^6*cos(phi)^4*sin(phi)^2 - 4*3^(1/2)*r^6*cos(phi)^3*sin(phi)^3 + 7*r^6*cos(phi)^2*sin(phi)^4 - 2*3^(1/2)*r^6*cos(phi)*sin(phi)^5 + 3*r^6*sin(phi)^6 + 6*r^5*x*cos(phi)^5 - 10*3^(1/2)*r^5*x*cos(phi)^4*sin(phi) + 28*r^5*x*cos(phi)^3*sin(phi)^2 - 20*3^(1/2)*r^5*x*cos(phi)^2*sin(phi)^3 + 22*r^5*x*cos(phi)*sin(phi)^4 - 10*3^(1/2)*r^5*x*sin(phi)^5 + 2*3^(1/2)*r^5*y*cos(phi)^5 - 10*r^5*y*cos(phi)^4*sin(phi) + 4*3^(1/2)*r^5*y*cos(phi)^3*sin(phi)^2 - 4*r^5*y*cos(phi)^2*sin(phi)^3 + 2*3^(1/2)*r^5*y*cos(phi)*sin(phi)^4 + 6*r^5*y*sin(phi)^5 + 15*r^4*x^2*cos(phi)^4 - 24*3^(1/2)*r^4*x^2*cos(phi)^3*sin(phi) + 66*r^4*x^2*cos(phi)^2*sin(phi)^2 - 32*3^(1/2)*r^4*x^2*cos(phi)*sin(phi)^3 + 43*r^4*x^2*sin(phi)^4 + 10*3^(1/2)*r^4*x*y*cos(phi)^4 - 32*r^4*x*y*cos(phi)^3*sin(phi) + 12*3^(1/2)*r^4*x*y*cos(phi)^2*sin(phi)^2 - 16*r^4*x*y*cos(phi)*sin(phi)^3 - 14*3^(1/2)*r^4*x*y*sin(phi)^4 + 5*r^4*y^2*cos(phi)^4 - 8*3^(1/2)*r^4*y^2*cos(phi)^3*sin(phi) + 6*r^4*y^2*cos(phi)^2*sin(phi)^2 + 9*r^4*y^2*sin(phi)^4 + 22*r^3*x^3*cos(phi)^3 - 34*3^(1/2)*r^3*x^3*cos(phi)^2*sin(phi) + 70*r^3*x^3*cos(phi)*sin(phi)^2 - 34*3^(1/2)*r^3*x^3*sin(phi)^3 + 18*3^(1/2)*r^3*x^2*y*cos(phi)^3 - 42*r^3*x^2*y*cos(phi)^2*sin(phi) + 18*3^(1/2)*r^3*x^2*y*cos(phi)*sin(phi)^2 + 38*r^3*x^2*y*sin(phi)^3 + 22*r^3*x*y^2*cos(phi)^3 - 18*3^(1/2)*r^3*x*y^2*cos(phi)^2*sin(phi) + 6*r^3*x*y^2*cos(phi)*sin(phi)^2 - 18*3^(1/2)*r^3*x*y^2*sin(phi)^3 + 2*3^(1/2)*r^3*y^3*cos(phi)^3 - 10*r^3*y^3*cos(phi)^2*sin(phi) + 2*3^(1/2)*r^3*y^3*cos(phi)*sin(phi)^2 + 6*r^3*y^3*sin(phi)^3 + 21*r^2*x^4*cos(phi)^2 - 26*3^(1/2)*r^2*x^4*cos(phi)*sin(phi) + 47*r^2*x^4*sin(phi)^2 + 16*3^(1/2)*r^2*x^3*y*cos(phi)^2 - 32*r^2*x^3*y*cos(phi)*sin(phi) - 16*3^(1/2)*r^2*x^3*y*sin(phi)^2 + 30*r^2*x^2*y^2*cos(phi)^2 - 12*3^(1/2)*r^2*x^2*y^2*cos(phi)*sin(phi) + 42*r^2*x^2*y^2*sin(phi)^2 + 8*3^(1/2)*r^2*x*y^3*cos(phi)^2 - 16*r^2*x*y^3*cos(phi)*sin(phi) - 8*3^(1/2)*r^2*x*y^3*sin(phi)^2 + r^2*y^4*cos(phi)^2 - 2*3^(1/2)*r^2*y^4*cos(phi)*sin(phi) + 3*r^2*y^4*sin(phi)^2 + 12*r*x^5*cos(phi) - 12*3^(1/2)*r*x^5*sin(phi) + 8*3^(1/2)*r*x^4*y*cos(phi) + 8*r*x^4*y*sin(phi) + 16*r*x^3*y^2*cos(phi) - 16*3^(1/2)*r*x^3*y^2*sin(phi) + 8*3^(1/2)*r*x^2*y^3*cos(phi) + 8*r*x^2*y^3*sin(phi) + 4*r*x*y^4*cos(phi) - 4*3^(1/2)*r*x*y^4*sin(phi) + 4*x^6 + 8*x^4*y^2 + 4*x^2*y^4)/(r^4*cos(phi)^4 - 4*3^(1/2)*r^4*cos(phi)^3*sin(phi) + 18*r^4*cos(phi)^2*sin(phi)^2 - 12*3^(1/2)*r^4*cos(phi)*sin(phi)^3 + 9*r^4*sin(phi)^4 + 8*r^3*x*cos(phi)^3 - 24*3^(1/2)*r^3*x*cos(phi)^2*sin(phi) + 72*r^3*x*cos(phi)*sin(phi)^2 - 24*3^(1/2)*r^3*x*sin(phi)^3 + 24*r^2*x^2*cos(phi)^2 - 48*3^(1/2)*r^2*x^2*cos(phi)*sin(phi) + 72*r^2*x^2*sin(phi)^2 + 32*r*x^3*cos(phi) - 32*3^(1/2)*r*x^3*sin(phi) + 16*x^4))^(1/2) + 2*r^2*x*cos(phi + pi/3)*sin(phi + pi/3) + 2*r*x*y*cos(phi + pi/3))/(2*(r^2*cos(phi + pi/3)^2 + r^2*sin(phi + pi/3)^2 + 2*r*x*cos(phi + pi/3) + 2*r*y*sin(phi + pi/3) + x^2 + y^2));
 (2*x^2*(-(L^4*r^2*cos(phi)^2 - 2*3^(1/2)*L^4*r^2*cos(phi)*sin(phi) + 3*L^4*r^2*sin(phi)^2 + 4*L^4*r*x*cos(phi) - 4*3^(1/2)*L^4*r*x*sin(phi) + 4*L^4*x^2 - 2*L^2*R^2*r^2*cos(phi)^2 + 4*3^(1/2)*L^2*R^2*r^2*cos(phi)*sin(phi) - 6*L^2*R^2*r^2*sin(phi)^2 - 8*L^2*R^2*r*x*cos(phi) + 8*3^(1/2)*L^2*R^2*r*x*sin(phi) - 8*L^2*R^2*x^2 - 2*L^2*r^4*cos(phi)^4 + 4*3^(1/2)*L^2*r^4*cos(phi)^3*sin(phi) - 8*L^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*L^2*r^4*cos(phi)*sin(phi)^3 - 6*L^2*r^4*sin(phi)^4 - 10*L^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*L^2*r^3*x*cos(phi)^2*sin(phi) - 26*L^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*L^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*L^2*r^3*y*cos(phi)^3 + 10*L^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*L^2*r^3*y*cos(phi)*sin(phi)^2 - 6*L^2*r^3*y*sin(phi)^3 - 18*L^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*L^2*r^2*x^2*cos(phi)*sin(phi) - 38*L^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*L^2*r^2*x*y*cos(phi)^2 + 16*L^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*L^2*r^2*x*y*sin(phi)^2 - 2*L^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*L^2*r^2*y^2*cos(phi)*sin(phi) - 6*L^2*r^2*y^2*sin(phi)^2 - 16*L^2*r*x^3*cos(phi) + 16*3^(1/2)*L^2*r*x^3*sin(phi) - 8*3^(1/2)*L^2*r*x^2*y*cos(phi) - 8*L^2*r*x^2*y*sin(phi) - 8*L^2*r*x*y^2*cos(phi) + 8*3^(1/2)*L^2*r*x*y^2*sin(phi) - 8*L^2*x^4 - 8*L^2*x^2*y^2 + R^4*r^2*cos(phi)^2 - 2*3^(1/2)*R^4*r^2*cos(phi)*sin(phi) + 3*R^4*r^2*sin(phi)^2 + 4*R^4*r*x*cos(phi) - 4*3^(1/2)*R^4*r*x*sin(phi) + 4*R^4*x^2 - 2*R^2*r^4*cos(phi)^4 + 4*3^(1/2)*R^2*r^4*cos(phi)^3*sin(phi) - 8*R^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*R^2*r^4*cos(phi)*sin(phi)^3 - 6*R^2*r^4*sin(phi)^4 - 10*R^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*R^2*r^3*x*cos(phi)^2*sin(phi) - 26*R^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*R^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*R^2*r^3*y*cos(phi)^3 + 10*R^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*R^2*r^3*y*cos(phi)*sin(phi)^2 - 6*R^2*r^3*y*sin(phi)^3 - 18*R^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*R^2*r^2*x^2*cos(phi)*sin(phi) - 38*R^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*R^2*r^2*x*y*cos(phi)^2 + 16*R^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*R^2*r^2*x*y*sin(phi)^2 - 2*R^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*R^2*r^2*y^2*cos(phi)*sin(phi) - 6*R^2*r^2*y^2*sin(phi)^2 - 16*R^2*r*x^3*cos(phi) + 16*3^(1/2)*R^2*r*x^3*sin(phi) - 8*3^(1/2)*R^2*r*x^2*y*cos(phi) - 8*R^2*r*x^2*y*sin(phi) - 8*R^2*r*x*y^2*cos(phi) + 8*3^(1/2)*R^2*r*x*y^2*sin(phi) - 8*R^2*x^4 - 8*R^2*x^2*y^2 + r^6*cos(phi)^6 - 2*3^(1/2)*r^6*cos(phi)^5*sin(phi) + 5*r^6*cos(phi)^4*sin(phi)^2 - 4*3^(1/2)*r^6*cos(phi)^3*sin(phi)^3 + 7*r^6*cos(phi)^2*sin(phi)^4 - 2*3^(1/2)*r^6*cos(phi)*sin(phi)^5 + 3*r^6*sin(phi)^6 + 6*r^5*x*cos(phi)^5 - 10*3^(1/2)*r^5*x*cos(phi)^4*sin(phi) + 28*r^5*x*cos(phi)^3*sin(phi)^2 - 20*3^(1/2)*r^5*x*cos(phi)^2*sin(phi)^3 + 22*r^5*x*cos(phi)*sin(phi)^4 - 10*3^(1/2)*r^5*x*sin(phi)^5 + 2*3^(1/2)*r^5*y*cos(phi)^5 - 10*r^5*y*cos(phi)^4*sin(phi) + 4*3^(1/2)*r^5*y*cos(phi)^3*sin(phi)^2 - 4*r^5*y*cos(phi)^2*sin(phi)^3 + 2*3^(1/2)*r^5*y*cos(phi)*sin(phi)^4 + 6*r^5*y*sin(phi)^5 + 15*r^4*x^2*cos(phi)^4 - 24*3^(1/2)*r^4*x^2*cos(phi)^3*sin(phi) + 66*r^4*x^2*cos(phi)^2*sin(phi)^2 - 32*3^(1/2)*r^4*x^2*cos(phi)*sin(phi)^3 + 43*r^4*x^2*sin(phi)^4 + 10*3^(1/2)*r^4*x*y*cos(phi)^4 - 32*r^4*x*y*cos(phi)^3*sin(phi) + 12*3^(1/2)*r^4*x*y*cos(phi)^2*sin(phi)^2 - 16*r^4*x*y*cos(phi)*sin(phi)^3 - 14*3^(1/2)*r^4*x*y*sin(phi)^4 + 5*r^4*y^2*cos(phi)^4 - 8*3^(1/2)*r^4*y^2*cos(phi)^3*sin(phi) + 6*r^4*y^2*cos(phi)^2*sin(phi)^2 + 9*r^4*y^2*sin(phi)^4 + 22*r^3*x^3*cos(phi)^3 - 34*3^(1/2)*r^3*x^3*cos(phi)^2*sin(phi) + 70*r^3*x^3*cos(phi)*sin(phi)^2 - 34*3^(1/2)*r^3*x^3*sin(phi)^3 + 18*3^(1/2)*r^3*x^2*y*cos(phi)^3 - 42*r^3*x^2*y*cos(phi)^2*sin(phi) + 18*3^(1/2)*r^3*x^2*y*cos(phi)*sin(phi)^2 + 38*r^3*x^2*y*sin(phi)^3 + 22*r^3*x*y^2*cos(phi)^3 - 18*3^(1/2)*r^3*x*y^2*cos(phi)^2*sin(phi) + 6*r^3*x*y^2*cos(phi)*sin(phi)^2 - 18*3^(1/2)*r^3*x*y^2*sin(phi)^3 + 2*3^(1/2)*r^3*y^3*cos(phi)^3 - 10*r^3*y^3*cos(phi)^2*sin(phi) + 2*3^(1/2)*r^3*y^3*cos(phi)*sin(phi)^2 + 6*r^3*y^3*sin(phi)^3 + 21*r^2*x^4*cos(phi)^2 - 26*3^(1/2)*r^2*x^4*cos(phi)*sin(phi) + 47*r^2*x^4*sin(phi)^2 + 16*3^(1/2)*r^2*x^3*y*cos(phi)^2 - 32*r^2*x^3*y*cos(phi)*sin(phi) - 16*3^(1/2)*r^2*x^3*y*sin(phi)^2 + 30*r^2*x^2*y^2*cos(phi)^2 - 12*3^(1/2)*r^2*x^2*y^2*cos(phi)*sin(phi) + 42*r^2*x^2*y^2*sin(phi)^2 + 8*3^(1/2)*r^2*x*y^3*cos(phi)^2 - 16*r^2*x*y^3*cos(phi)*sin(phi) - 8*3^(1/2)*r^2*x*y^3*sin(phi)^2 + r^2*y^4*cos(phi)^2 - 2*3^(1/2)*r^2*y^4*cos(phi)*sin(phi) + 3*r^2*y^4*sin(phi)^2 + 12*r*x^5*cos(phi) - 12*3^(1/2)*r*x^5*sin(phi) + 8*3^(1/2)*r*x^4*y*cos(phi) + 8*r*x^4*y*sin(phi) + 16*r*x^3*y^2*cos(phi) - 16*3^(1/2)*r*x^3*y^2*sin(phi) + 8*3^(1/2)*r*x^2*y^3*cos(phi) + 8*r*x^2*y^3*sin(phi) + 4*r*x*y^4*cos(phi) - 4*3^(1/2)*r*x*y^4*sin(phi) + 4*x^6 + 8*x^4*y^2 + 4*x^2*y^4)/(r^4*cos(phi)^4 - 4*3^(1/2)*r^4*cos(phi)^3*sin(phi) + 18*r^4*cos(phi)^2*sin(phi)^2 - 12*3^(1/2)*r^4*cos(phi)*sin(phi)^3 + 9*r^4*sin(phi)^4 + 8*r^3*x*cos(phi)^3 - 24*3^(1/2)*r^3*x*cos(phi)^2*sin(phi) + 72*r^3*x*cos(phi)*sin(phi)^2 - 24*3^(1/2)*r^3*x*sin(phi)^3 + 24*r^2*x^2*cos(phi)^2 - 48*3^(1/2)*r^2*x^2*cos(phi)*sin(phi) + 72*r^2*x^2*sin(phi)^2 + 32*r*x^3*cos(phi) - 32*3^(1/2)*r*x^3*sin(phi) + 16*x^4))^(1/2) + r^3*sin(phi + pi/3)^3 - L^2*y + R^2*y + x^2*y + y^3 + r^3*cos(phi + pi/3)^2*sin(phi + pi/3) - L^2*r*sin(phi + pi/3) + R^2*r*sin(phi + pi/3) + r*x^2*sin(phi + pi/3) + 3*r*y^2*sin(phi + pi/3) + 2*r^2*cos(phi + pi/3)^2*(-(L^4*r^2*cos(phi)^2 - 2*3^(1/2)*L^4*r^2*cos(phi)*sin(phi) + 3*L^4*r^2*sin(phi)^2 + 4*L^4*r*x*cos(phi) - 4*3^(1/2)*L^4*r*x*sin(phi) + 4*L^4*x^2 - 2*L^2*R^2*r^2*cos(phi)^2 + 4*3^(1/2)*L^2*R^2*r^2*cos(phi)*sin(phi) - 6*L^2*R^2*r^2*sin(phi)^2 - 8*L^2*R^2*r*x*cos(phi) + 8*3^(1/2)*L^2*R^2*r*x*sin(phi) - 8*L^2*R^2*x^2 - 2*L^2*r^4*cos(phi)^4 + 4*3^(1/2)*L^2*r^4*cos(phi)^3*sin(phi) - 8*L^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*L^2*r^4*cos(phi)*sin(phi)^3 - 6*L^2*r^4*sin(phi)^4 - 10*L^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*L^2*r^3*x*cos(phi)^2*sin(phi) - 26*L^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*L^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*L^2*r^3*y*cos(phi)^3 + 10*L^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*L^2*r^3*y*cos(phi)*sin(phi)^2 - 6*L^2*r^3*y*sin(phi)^3 - 18*L^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*L^2*r^2*x^2*cos(phi)*sin(phi) - 38*L^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*L^2*r^2*x*y*cos(phi)^2 + 16*L^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*L^2*r^2*x*y*sin(phi)^2 - 2*L^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*L^2*r^2*y^2*cos(phi)*sin(phi) - 6*L^2*r^2*y^2*sin(phi)^2 - 16*L^2*r*x^3*cos(phi) + 16*3^(1/2)*L^2*r*x^3*sin(phi) - 8*3^(1/2)*L^2*r*x^2*y*cos(phi) - 8*L^2*r*x^2*y*sin(phi) - 8*L^2*r*x*y^2*cos(phi) + 8*3^(1/2)*L^2*r*x*y^2*sin(phi) - 8*L^2*x^4 - 8*L^2*x^2*y^2 + R^4*r^2*cos(phi)^2 - 2*3^(1/2)*R^4*r^2*cos(phi)*sin(phi) + 3*R^4*r^2*sin(phi)^2 + 4*R^4*r*x*cos(phi) - 4*3^(1/2)*R^4*r*x*sin(phi) + 4*R^4*x^2 - 2*R^2*r^4*cos(phi)^4 + 4*3^(1/2)*R^2*r^4*cos(phi)^3*sin(phi) - 8*R^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*R^2*r^4*cos(phi)*sin(phi)^3 - 6*R^2*r^4*sin(phi)^4 - 10*R^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*R^2*r^3*x*cos(phi)^2*sin(phi) - 26*R^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*R^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*R^2*r^3*y*cos(phi)^3 + 10*R^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*R^2*r^3*y*cos(phi)*sin(phi)^2 - 6*R^2*r^3*y*sin(phi)^3 - 18*R^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*R^2*r^2*x^2*cos(phi)*sin(phi) - 38*R^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*R^2*r^2*x*y*cos(phi)^2 + 16*R^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*R^2*r^2*x*y*sin(phi)^2 - 2*R^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*R^2*r^2*y^2*cos(phi)*sin(phi) - 6*R^2*r^2*y^2*sin(phi)^2 - 16*R^2*r*x^3*cos(phi) + 16*3^(1/2)*R^2*r*x^3*sin(phi) - 8*3^(1/2)*R^2*r*x^2*y*cos(phi) - 8*R^2*r*x^2*y*sin(phi) - 8*R^2*r*x*y^2*cos(phi) + 8*3^(1/2)*R^2*r*x*y^2*sin(phi) - 8*R^2*x^4 - 8*R^2*x^2*y^2 + r^6*cos(phi)^6 - 2*3^(1/2)*r^6*cos(phi)^5*sin(phi) + 5*r^6*cos(phi)^4*sin(phi)^2 - 4*3^(1/2)*r^6*cos(phi)^3*sin(phi)^3 + 7*r^6*cos(phi)^2*sin(phi)^4 - 2*3^(1/2)*r^6*cos(phi)*sin(phi)^5 + 3*r^6*sin(phi)^6 + 6*r^5*x*cos(phi)^5 - 10*3^(1/2)*r^5*x*cos(phi)^4*sin(phi) + 28*r^5*x*cos(phi)^3*sin(phi)^2 - 20*3^(1/2)*r^5*x*cos(phi)^2*sin(phi)^3 + 22*r^5*x*cos(phi)*sin(phi)^4 - 10*3^(1/2)*r^5*x*sin(phi)^5 + 2*3^(1/2)*r^5*y*cos(phi)^5 - 10*r^5*y*cos(phi)^4*sin(phi) + 4*3^(1/2)*r^5*y*cos(phi)^3*sin(phi)^2 - 4*r^5*y*cos(phi)^2*sin(phi)^3 + 2*3^(1/2)*r^5*y*cos(phi)*sin(phi)^4 + 6*r^5*y*sin(phi)^5 + 15*r^4*x^2*cos(phi)^4 - 24*3^(1/2)*r^4*x^2*cos(phi)^3*sin(phi) + 66*r^4*x^2*cos(phi)^2*sin(phi)^2 - 32*3^(1/2)*r^4*x^2*cos(phi)*sin(phi)^3 + 43*r^4*x^2*sin(phi)^4 + 10*3^(1/2)*r^4*x*y*cos(phi)^4 - 32*r^4*x*y*cos(phi)^3*sin(phi) + 12*3^(1/2)*r^4*x*y*cos(phi)^2*sin(phi)^2 - 16*r^4*x*y*cos(phi)*sin(phi)^3 - 14*3^(1/2)*r^4*x*y*sin(phi)^4 + 5*r^4*y^2*cos(phi)^4 - 8*3^(1/2)*r^4*y^2*cos(phi)^3*sin(phi) + 6*r^4*y^2*cos(phi)^2*sin(phi)^2 + 9*r^4*y^2*sin(phi)^4 + 22*r^3*x^3*cos(phi)^3 - 34*3^(1/2)*r^3*x^3*cos(phi)^2*sin(phi) + 70*r^3*x^3*cos(phi)*sin(phi)^2 - 34*3^(1/2)*r^3*x^3*sin(phi)^3 + 18*3^(1/2)*r^3*x^2*y*cos(phi)^3 - 42*r^3*x^2*y*cos(phi)^2*sin(phi) + 18*3^(1/2)*r^3*x^2*y*cos(phi)*sin(phi)^2 + 38*r^3*x^2*y*sin(phi)^3 + 22*r^3*x*y^2*cos(phi)^3 - 18*3^(1/2)*r^3*x*y^2*cos(phi)^2*sin(phi) + 6*r^3*x*y^2*cos(phi)*sin(phi)^2 - 18*3^(1/2)*r^3*x*y^2*sin(phi)^3 + 2*3^(1/2)*r^3*y^3*cos(phi)^3 - 10*r^3*y^3*cos(phi)^2*sin(phi) + 2*3^(1/2)*r^3*y^3*cos(phi)*sin(phi)^2 + 6*r^3*y^3*sin(phi)^3 + 21*r^2*x^4*cos(phi)^2 - 26*3^(1/2)*r^2*x^4*cos(phi)*sin(phi) + 47*r^2*x^4*sin(phi)^2 + 16*3^(1/2)*r^2*x^3*y*cos(phi)^2 - 32*r^2*x^3*y*cos(phi)*sin(phi) - 16*3^(1/2)*r^2*x^3*y*sin(phi)^2 + 30*r^2*x^2*y^2*cos(phi)^2 - 12*3^(1/2)*r^2*x^2*y^2*cos(phi)*sin(phi) + 42*r^2*x^2*y^2*sin(phi)^2 + 8*3^(1/2)*r^2*x*y^3*cos(phi)^2 - 16*r^2*x*y^3*cos(phi)*sin(phi) - 8*3^(1/2)*r^2*x*y^3*sin(phi)^2 + r^2*y^4*cos(phi)^2 - 2*3^(1/2)*r^2*y^4*cos(phi)*sin(phi) + 3*r^2*y^4*sin(phi)^2 + 12*r*x^5*cos(phi) - 12*3^(1/2)*r*x^5*sin(phi) + 8*3^(1/2)*r*x^4*y*cos(phi) + 8*r*x^4*y*sin(phi) + 16*r*x^3*y^2*cos(phi) - 16*3^(1/2)*r*x^3*y^2*sin(phi) + 8*3^(1/2)*r*x^2*y^3*cos(phi) + 8*r*x^2*y^3*sin(phi) + 4*r*x*y^4*cos(phi) - 4*3^(1/2)*r*x*y^4*sin(phi) + 4*x^6 + 8*x^4*y^2 + 4*x^2*y^4)/(r^4*cos(phi)^4 - 4*3^(1/2)*r^4*cos(phi)^3*sin(phi) + 18*r^4*cos(phi)^2*sin(phi)^2 - 12*3^(1/2)*r^4*cos(phi)*sin(phi)^3 + 9*r^4*sin(phi)^4 + 8*r^3*x*cos(phi)^3 - 24*3^(1/2)*r^3*x*cos(phi)^2*sin(phi) + 72*r^3*x*cos(phi)*sin(phi)^2 - 24*3^(1/2)*r^3*x*sin(phi)^3 + 24*r^2*x^2*cos(phi)^2 - 48*3^(1/2)*r^2*x^2*cos(phi)*sin(phi) + 72*r^2*x^2*sin(phi)^2 + 32*r*x^3*cos(phi) - 32*3^(1/2)*r*x^3*sin(phi) + 16*x^4))^(1/2) + r^2*y*cos(phi + pi/3)^2 + 3*r^2*y*sin(phi + pi/3)^2 + 4*r*x*cos(phi + pi/3)*(-(L^4*r^2*cos(phi)^2 - 2*3^(1/2)*L^4*r^2*cos(phi)*sin(phi) + 3*L^4*r^2*sin(phi)^2 + 4*L^4*r*x*cos(phi) - 4*3^(1/2)*L^4*r*x*sin(phi) + 4*L^4*x^2 - 2*L^2*R^2*r^2*cos(phi)^2 + 4*3^(1/2)*L^2*R^2*r^2*cos(phi)*sin(phi) - 6*L^2*R^2*r^2*sin(phi)^2 - 8*L^2*R^2*r*x*cos(phi) + 8*3^(1/2)*L^2*R^2*r*x*sin(phi) - 8*L^2*R^2*x^2 - 2*L^2*r^4*cos(phi)^4 + 4*3^(1/2)*L^2*r^4*cos(phi)^3*sin(phi) - 8*L^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*L^2*r^4*cos(phi)*sin(phi)^3 - 6*L^2*r^4*sin(phi)^4 - 10*L^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*L^2*r^3*x*cos(phi)^2*sin(phi) - 26*L^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*L^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*L^2*r^3*y*cos(phi)^3 + 10*L^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*L^2*r^3*y*cos(phi)*sin(phi)^2 - 6*L^2*r^3*y*sin(phi)^3 - 18*L^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*L^2*r^2*x^2*cos(phi)*sin(phi) - 38*L^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*L^2*r^2*x*y*cos(phi)^2 + 16*L^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*L^2*r^2*x*y*sin(phi)^2 - 2*L^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*L^2*r^2*y^2*cos(phi)*sin(phi) - 6*L^2*r^2*y^2*sin(phi)^2 - 16*L^2*r*x^3*cos(phi) + 16*3^(1/2)*L^2*r*x^3*sin(phi) - 8*3^(1/2)*L^2*r*x^2*y*cos(phi) - 8*L^2*r*x^2*y*sin(phi) - 8*L^2*r*x*y^2*cos(phi) + 8*3^(1/2)*L^2*r*x*y^2*sin(phi) - 8*L^2*x^4 - 8*L^2*x^2*y^2 + R^4*r^2*cos(phi)^2 - 2*3^(1/2)*R^4*r^2*cos(phi)*sin(phi) + 3*R^4*r^2*sin(phi)^2 + 4*R^4*r*x*cos(phi) - 4*3^(1/2)*R^4*r*x*sin(phi) + 4*R^4*x^2 - 2*R^2*r^4*cos(phi)^4 + 4*3^(1/2)*R^2*r^4*cos(phi)^3*sin(phi) - 8*R^2*r^4*cos(phi)^2*sin(phi)^2 + 4*3^(1/2)*R^2*r^4*cos(phi)*sin(phi)^3 - 6*R^2*r^4*sin(phi)^4 - 10*R^2*r^3*x*cos(phi)^3 + 14*3^(1/2)*R^2*r^3*x*cos(phi)^2*sin(phi) - 26*R^2*r^3*x*cos(phi)*sin(phi)^2 + 14*3^(1/2)*R^2*r^3*x*sin(phi)^3 - 2*3^(1/2)*R^2*r^3*y*cos(phi)^3 + 10*R^2*r^3*y*cos(phi)^2*sin(phi) - 2*3^(1/2)*R^2*r^3*y*cos(phi)*sin(phi)^2 - 6*R^2*r^3*y*sin(phi)^3 - 18*R^2*r^2*x^2*cos(phi)^2 + 20*3^(1/2)*R^2*r^2*x^2*cos(phi)*sin(phi) - 38*R^2*r^2*x^2*sin(phi)^2 - 8*3^(1/2)*R^2*r^2*x*y*cos(phi)^2 + 16*R^2*r^2*x*y*cos(phi)*sin(phi) + 8*3^(1/2)*R^2*r^2*x*y*sin(phi)^2 - 2*R^2*r^2*y^2*cos(phi)^2 + 4*3^(1/2)*R^2*r^2*y^2*cos(phi)*sin(phi) - 6*R^2*r^2*y^2*sin(phi)^2 - 16*R^2*r*x^3*cos(phi) + 16*3^(1/2)*R^2*r*x^3*sin(phi) - 8*3^(1/2)*R^2*r*x^2*y*cos(phi) - 8*R^2*r*x^2*y*sin(phi) - 8*R^2*r*x*y^2*cos(phi) + 8*3^(1/2)*R^2*r*x*y^2*sin(phi) - 8*R^2*x^4 - 8*R^2*x^2*y^2 + r^6*cos(phi)^6 - 2*3^(1/2)*r^6*cos(phi)^5*sin(phi) + 5*r^6*cos(phi)^4*sin(phi)^2 - 4*3^(1/2)*r^6*cos(phi)^3*sin(phi)^3 + 7*r^6*cos(phi)^2*sin(phi)^4 - 2*3^(1/2)*r^6*cos(phi)*sin(phi)^5 + 3*r^6*sin(phi)^6 + 6*r^5*x*cos(phi)^5 - 10*3^(1/2)*r^5*x*cos(phi)^4*sin(phi) + 28*r^5*x*cos(phi)^3*sin(phi)^2 - 20*3^(1/2)*r^5*x*cos(phi)^2*sin(phi)^3 + 22*r^5*x*cos(phi)*sin(phi)^4 - 10*3^(1/2)*r^5*x*sin(phi)^5 + 2*3^(1/2)*r^5*y*cos(phi)^5 - 10*r^5*y*cos(phi)^4*sin(phi) + 4*3^(1/2)*r^5*y*cos(phi)^3*sin(phi)^2 - 4*r^5*y*cos(phi)^2*sin(phi)^3 + 2*3^(1/2)*r^5*y*cos(phi)*sin(phi)^4 + 6*r^5*y*sin(phi)^5 + 15*r^4*x^2*cos(phi)^4 - 24*3^(1/2)*r^4*x^2*cos(phi)^3*sin(phi) + 66*r^4*x^2*cos(phi)^2*sin(phi)^2 - 32*3^(1/2)*r^4*x^2*cos(phi)*sin(phi)^3 + 43*r^4*x^2*sin(phi)^4 + 10*3^(1/2)*r^4*x*y*cos(phi)^4 - 32*r^4*x*y*cos(phi)^3*sin(phi) + 12*3^(1/2)*r^4*x*y*cos(phi)^2*sin(phi)^2 - 16*r^4*x*y*cos(phi)*sin(phi)^3 - 14*3^(1/2)*r^4*x*y*sin(phi)^4 + 5*r^4*y^2*cos(phi)^4 - 8*3^(1/2)*r^4*y^2*cos(phi)^3*sin(phi) + 6*r^4*y^2*cos(phi)^2*sin(phi)^2 + 9*r^4*y^2*sin(phi)^4 + 22*r^3*x^3*cos(phi)^3 - 34*3^(1/2)*r^3*x^3*cos(phi)^2*sin(phi) + 70*r^3*x^3*cos(phi)*sin(phi)^2 - 34*3^(1/2)*r^3*x^3*sin(phi)^3 + 18*3^(1/2)*r^3*x^2*y*cos(phi)^3 - 42*r^3*x^2*y*cos(phi)^2*sin(phi) + 18*3^(1/2)*r^3*x^2*y*cos(phi)*sin(phi)^2 + 38*r^3*x^2*y*sin(phi)^3 + 22*r^3*x*y^2*cos(phi)^3 - 18*3^(1/2)*r^3*x*y^2*cos(phi)^2*sin(phi) + 6*r^3*x*y^2*cos(phi)*sin(phi)^2 - 18*3^(1/2)*r^3*x*y^2*sin(phi)^3 + 2*3^(1/2)*r^3*y^3*cos(phi)^3 - 10*r^3*y^3*cos(phi)^2*sin(phi) + 2*3^(1/2)*r^3*y^3*cos(phi)*sin(phi)^2 + 6*r^3*y^3*sin(phi)^3 + 21*r^2*x^4*cos(phi)^2 - 26*3^(1/2)*r^2*x^4*cos(phi)*sin(phi) + 47*r^2*x^4*sin(phi)^2 + 16*3^(1/2)*r^2*x^3*y*cos(phi)^2 - 32*r^2*x^3*y*cos(phi)*sin(phi) - 16*3^(1/2)*r^2*x^3*y*sin(phi)^2 + 30*r^2*x^2*y^2*cos(phi)^2 - 12*3^(1/2)*r^2*x^2*y^2*cos(phi)*sin(phi) + 42*r^2*x^2*y^2*sin(phi)^2 + 8*3^(1/2)*r^2*x*y^3*cos(phi)^2 - 16*r^2*x*y^3*cos(phi)*sin(phi) - 8*3^(1/2)*r^2*x*y^3*sin(phi)^2 + r^2*y^4*cos(phi)^2 - 2*3^(1/2)*r^2*y^4*cos(phi)*sin(phi) + 3*r^2*y^4*sin(phi)^2 + 12*r*x^5*cos(phi) - 12*3^(1/2)*r*x^5*sin(phi) + 8*3^(1/2)*r*x^4*y*cos(phi) + 8*r*x^4*y*sin(phi) + 16*r*x^3*y^2*cos(phi) - 16*3^(1/2)*r*x^3*y^2*sin(phi) + 8*3^(1/2)*r*x^2*y^3*cos(phi) + 8*r*x^2*y^3*sin(phi) + 4*r*x*y^4*cos(phi) - 4*3^(1/2)*r*x*y^4*sin(phi) + 4*x^6 + 8*x^4*y^2 + 4*x^2*y^4)/(r^4*cos(phi)^4 - 4*3^(1/2)*r^4*cos(phi)^3*sin(phi) + 18*r^4*cos(phi)^2*sin(phi)^2 - 12*3^(1/2)*r^4*cos(phi)*sin(phi)^3 + 9*r^4*sin(phi)^4 + 8*r^3*x*cos(phi)^3 - 24*3^(1/2)*r^3*x*cos(phi)^2*sin(phi) + 72*r^3*x*cos(phi)*sin(phi)^2 - 24*3^(1/2)*r^3*x*sin(phi)^3 + 24*r^2*x^2*cos(phi)^2 - 48*3^(1/2)*r^2*x^2*cos(phi)*sin(phi) + 72*r^2*x^2*sin(phi)^2 + 32*r*x^3*cos(phi) - 32*3^(1/2)*r*x^3*sin(phi) + 16*x^4))^(1/2) + 2*r^2*x*cos(phi + pi/3)*sin(phi + pi/3) + 2*r*x*y*cos(phi + pi/3))/(2*(r^2*cos(phi + pi/3)^2 + r^2*sin(phi + pi/3)^2 + 2*r*x*cos(phi + pi/3) + 2*r*y*sin(phi + pi/3) + x^2 + y^2))];

x_b1=(x_a1^2+y_a1^2-2*y_a1*y_b1+R^2-L^2)/(2*x_a1);

teta1=atan2(y_b1,x_b1);

% Choosing the solution according the elbow vector
if elbow(1)==1
    q1=teta1(1);
else
    q1=teta1(2);
end
if elbow(2)==1
    q2=teta2(1);
else
    q2=teta2(2);
end

q3=d3(1);

% The output
q=[q1 q2 q3];